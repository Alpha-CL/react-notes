## umijs

### umi-cmd

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * umi
 * 
 * 
 * 全局安装，因需要使用命令行
 */
 
yarn global add umi


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


// 若依据约定文件创建工程，则可以使用以下命令打包工程

umi dev                 // 使用开发模式启动工程


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

### directory structure

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


.
|
|-- pageage.json                    // 扩展集
|-- .umirc.ts                       // umi 内置插件及配置
|-- .env                            // 环境变量
|--
|-- dist                            // 执行 umi build 后，会将最终生产环境文件打包存放于此
|-- mock                            // 数据模拟: 该目录下所有 js 和 ts 文件会被解析为 mock 文件
|-- public                          // 该文件内的文件为静态资源文件，不会被打包
|-- 
|-- src
    |-- .umi                        // unmi 会将 入口文件，路由等 临时生成到该文件
    |--
    |-- layouts/index.tsx           // 约定式路由 全局约定式路由布局文件
    |-- document.ejs                // rootHtml:indexTemplate.html 
    |--                             
    |-- pages                       // 所有路由组件存放于此
        |-- sub
            |-- _layouts/index.tsx  // 局部约定式路由布局文件
            |--
            |-- index.tex
            |-- index.less
            |--
        |-- index.tsx
        |-- index.less
    |--
    |-- app.tx                      // 修改路由、修改 render 方法等


* 约定式路由: 可将不同页面中公共组件部分固定
* layout/index.tsx: 全局约定式路由布局文件
* _layout/index.tsx: 局部约定式路由布局文件


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * .env
 * 
 * 
 * 配置 umi 环境变量
 */


PORT=8888                   // 设置本地服务端口
MOCK=none                   // 是否关闭 mock 模拟数据

UMI_ENV=local               // umi 允许配置多个配置文件，多个配置文件最终会合并
                            // 当 UMI_ENV=local 则 .umirc.local.js 文件生效，并优先级高于 .umrc.js
...


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

### umi-router

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * umi-router
 * 
 * 
 * 1) 约定式: 根据 "约定好的文件夹和文件规则" 自动生成路由( umi 会根据 pages 中的页面生成路由配置 )
 * 
 * 2) 配置式: 直接书写 路由配置 文件
 */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### Conventional Router

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * umi 约定
 * 
 * 
 * pages: 工程中 "pages" 文件夹中存放的是页面，若工程包含 src 目录，则 "src/pages" 是页面文件夹
 * 
 * routerInfo: umi 会自动将 当前页面的文件名及文件路径，设置为该页面的路由匹配信息
 * 
 * index: 若页面文件名为 index，则可以省略文件名( 为当前文件夹的索引文件 )，避免文件名和当前目录中的子文件夹重名
 * 
 * src/layout( 全局通用布局 ): 可固定多页面中相同的组件部分，再利用 {props.children} 渲染不同的组件 
 * doc/_layout( 局部通用布局 ): 可固定多页面中相同的组件部分，再利用 {props.children} 渲染不同的组件
 * 
 * pages/404: 若路由匹配失败，则会渲染该页面( 该约定在开发模式中无效，仅在部署后生效 ) 
 * 
 * [filename]: 动态路由( 必须为 / + [filename] === /:key )
 *            ( [filename] === :( 路由正则 ) , [filename$] === ?( 可选 ) )
 */


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * router link
 * 
 * 
 ** @: 在文件路径中使用时默认代表 src 路径文件           // 可修改该配置
 */


// component

import {Link, NavLink, Redirect} form "umi";


// method

import history form "umi/router";

history: {

    go(),
    goBack(),
    goForward(),
    push(),
    replace(),
    ....
}


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * get routerInfo
 * 
 * 
 * 所有页面中都会通过 props 传递 路由信息
 */


props: {

    ...

    history,                // history === react-router.history
                            // history.query 使用 query-string 重新封装为对象，便于获取地址栏参数数据
    location,               // location === react-router.location
    
    match,                  // match === react-router.match
    
    route,                  // 当前页面对应的路由配置信息
    
    ...
}

* 若需要在 自定义组件中 获取路由信息，则需要时候 HOC: withRouter 封装 


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### Configuration Router

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * react-router-config                  // umijs_router config
 * 
 * 
 * 使用 路由配置后，约定式路由全部失效
 */

// 两者皆可，任选其一
1) root/.umirc.ts                   
2) root/fonfig/config.ts            // 较复杂时，推荐在此文件中


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

### umi-dva

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * umi_dva
 * 
 * 
 * 
 */

global_models: 生产环境中时，一次性载入全部 model
    
    - path: @/src/models

section_models: 仅在需要页面或模块需要该 model 时，才载入( 开发模式全量载入 )

    - path: @src/pages/.../models/...

    - section_models 作用于 该页面 作用链上所有的模块文件( 作用链上的 祖先 和 子代 模块，兄弟模块除外 )
    
    - 当 section_models 文件夹中只有一个文件时，可以直接简写为 model.js 文件( 若要命名该模型，则需要使用 namespace: 'demo' )
    

// pages 文件夹中的 局部模块 会被路由引入( 解析模块错误 )，则需要使用在 umi-plugin-react 中配置 routes: { exclude: [ regexp, regexp ... ] }


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

### umi_of_css

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 在 umijs 中使用 less, sass           // css命名规则查询 css-module 规范
 * 
 * 
 * 原理 webpack 利用 css-loader( css-module )
 ** css-loader: 解决 样式重名
 ** .less/sass: 解决 css冗余
 
 */


// styleFile -> css-module -> styleObj

1) 组件样式: 仅作用于单个组件或页面的样式

    - path: 约定放置于 @/src/comps/comp/(index.css, index.less, index.sass )

2) 公共样式: 多个组件或页面的公共样式

    - path: assets/css/common.css

3) 全局样式: 样式名唯一，不经过 css-module 处理

    - path: @/src/global.css


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


// indes.css
.color {
    color: yellow;
}


// index.js
import styles from "./index.css";

function demo() {

    return (
    
        <React.Fragment>
        
            // 因 css-modele 处理后，原样式名会发生改变，则使用 处理后 'stylesObj.cssName' 引用样式
        
            <h1 className={styles.color}>hello world</h1>
            
        </React.Fragment>
    );
}


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

### umi_of_proxu

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * proxy
 * 
 * 
 * 
 */

                                        本地服务器会截获 请求地址，替换为 代理地址

    + ----------------- +               + ----------------- +               + ---------------------- +
    |                   |    request    |                   |    request    |                        |
    |  userAagency:     | ------------> |  ProxyServer:     | ------------> |  RemoteServer:         | 
    |  localhost:8000   | <------------ |  local_devServer  | <------------ |  target: api.demo.com  |
    |                   |     data      |                   |      data     |                        |
    + ----------------- +               + ----------------- +               + ---------------------- +

    requestUrl:                         requestUrl:       
    locationhost:800/api/users          api.demo.com/api/users


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

### umirc config

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


plugins：        配置umijs的插件
routes：         配置路由（会导致约定式路由失效）
history：        history对象模式（默认是browser）
outputPath：     使用umi build后，打包的目录名称，默认./dist
base:            相当于之前BrowserRouter中的basename
exportStatic:    开启该配置后，会打包成多个静态页面，每个页面对应一个路由，开启多静态页面应用的前提条件是：没有动态路由
...


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```